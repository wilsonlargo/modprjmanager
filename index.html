<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan Manager</title>
    <link rel="shortcut icon" href="assets/logo.png" type="image/png" />

    <!-- Boostrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://kit.fontawesome.com/3d0f9c201e.js" crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="src/util.js"></script>
    <script defer src="src/firebase.js" type="module"></script>
    <script defer src="src/components.js"></script>

    <link rel="stylesheet" href="src/style.css">
</head>

<body>
    <!-- Header -->
    <header class="sticky-top">
        <nav class="navbar bg-dark border-bottom border-body navbar-expand-lg" data-bs-theme="dark">

            <div class="container-fluid">
                <a class="navbar-brand" href="#"><img class="ms-3" src="assets/logo.png" width="50" height="50" /></a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="#" id="btn-header-crear">
                                <i class="bi bi-folder-plus"></i> Crear un proyecto</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="#" id="btn-header-cargar">
                                <i class="bi bi-eye"></i> Ver proyectos</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="#" onclick="mostrarPlano()">
                                <i class="bi bi-file-earmark-text-fill"></i> Ver documento plano</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <script>
        function mostrarPlano() {
            document.getElementById("contenedor-proyecto").hidden=true
            let docDiv = document.getElementById("docPlain")
            docDiv.innerHTML = ""

            docDiv.hidden=false

            let titulo=document.createElement("div")
            titulo.textContent=GLOBAL.state.proyecto.titulo
            titulo.className="h5 text-center mb-4"
            docDiv.appendChild(titulo)

            let objetObjetivos = GLOBAL.state.proyecto.objetivos

            objetObjetivos.forEach(objetivo => {
                //Creo div por cada objetivo
                let divObjetivo = document.createElement("div")

                //Creo uan fila para colocar el objetivo y el porcentaje
                let rowObjetivo = document.createElement("div")
                rowObjetivo.className = "row align-items-start ms-3 mb-2"

                //Creo y agrego una columna con el titulo del objetivo
                let colTitulo = document.createElement("div")
                colTitulo.className = "col"
                colTitulo.textContent = objetivo.enumerador + " " + objetivo.titulo
                rowObjetivo.appendChild(colTitulo)

                //Creo y agrego una columna con el porcentaje del objetivo
                let colPorcentaje = document.createElement("div")
                colPorcentaje.className = "col fs-3"
                colPorcentaje.textContent = " % " + objetivo.porcentaje
                rowObjetivo.appendChild(colPorcentaje)



                //Contar cuantas actividades hay en este objetivo
                let objetActividades = objetivo.actividades;
                objetActividades.forEach(actividad => {
                    let divActividades = document.createElement("div")
                    divActividades.className = "ms-3"

                    //Creo una fila para colocar la actividad y el porcentaje
                    let rowActividad = document.createElement("div")
                    rowActividad.className = "row align-items-start mt-2"

                    //Creo y agrego una columna con el nombre de la actividad
                    let colNombre = document.createElement("div")
                    colNombre.className = "col"
                    colNombre.textContent = actividad.enumerador + " " + actividad.nombre
                    rowActividad.appendChild(colNombre)

                    //Creo y agrego una columna con el porcentaje de la actividad
                    let colPorcentajeAC = document.createElement("div")
                    colPorcentajeAC.className = "col fs-3 text-success"
                    colPorcentajeAC.textContent = ""
                    rowActividad.appendChild(colPorcentajeAC)

                    //Ahora contamos cuantas evidencias hay
                    let objetEvidencias = actividad.evidencias;

                    objetEvidencias.forEach(evidencia => {
                        let divEvidencias = document.createElement("div")
                        divActividades.className = "ms-3 mt-3"
                        //Creo una fila para colocar la evidencia y su informaci√≥n
                        let rowEvidencia = document.createElement("div")
                        rowEvidencia.className = "row align-items-start mt-3 ms-3"

                        //Creo y agrego una columna con el nombre de la actividad
                        let colEvidencia = document.createElement("div")
                        colEvidencia.className = "col"
                        colEvidencia.textContent = evidencia.enumerador + ". " + evidencia.descripcion
                        rowEvidencia.appendChild(colEvidencia)

                        let colMetaEvi = document.createElement("div")
                        colMetaEvi.className = "col"
                        colMetaEvi.textContent = evidencia.meta
                        rowEvidencia.appendChild(colMetaEvi)

                        let colIndicadorEvi = document.createElement("div")
                        colIndicadorEvi.className = "col"
                        colIndicadorEvi.textContent = evidencia.indicador
                        rowEvidencia.appendChild(colIndicadorEvi)

                        let colPorcentajeEvi = document.createElement("div")
                        colPorcentajeEvi.className = "col"
                        colPorcentajeEvi.textContent = "Avance del %" + evidencia.porcentaje
                        rowEvidencia.appendChild(colPorcentajeEvi)

                        rowActividad.appendChild(rowEvidencia)


                    }

                    )




                    rowObjetivo.appendChild(rowActividad)



                })


                docDiv.appendChild(rowObjetivo)


            });




        }
    </script>


    <!-- Seccion pricipal -->
    <main class="">
        <section id="contenedor-proyecto" class="container border rounded p-3 my-4">

        </section>
    </main>
    <div id="docPlain">


    </div>

    <!-- Modal -->
    <!-- Button trigger modal -->
    <div class="modal fade" id="modalConfirmacion">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5">Confirmacion</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p id="modal-confirmar-body"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" id="btn-modal-confirmar" class="btn btn-primary">Confirmar</button>
                </div>
            </div>
        </div>
    </div>

</body>

</html>